<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>NavegaÃ§Ã£o por Voz - Supermercado (WebXR)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    /* Estilos gerais permanecem os mesmos */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
    }
    a-scene {
        height: 100vh;
        width: 100vw;
    }

    /* O botÃ£o de AR Ã© estilizado automaticamente pelo A-Frame, mas podemos ajustÃ¡-lo */
    .a-enter-ar-button {
        position: fixed;
        bottom: 120px !important;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 24px;
        font-size: 18px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        z-index: 10001 !important;
    }
    
    #muteButton {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 10px 20px;
      font-size: 18px;
      z-index: 10000;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.3s ease, background-color 0.3s ease;
    }
    #muteButton.rotating {
      transform: rotate(360deg);
    }
    #muteButton:hover {
      background-color: rgba(0, 0, 0, 0.9);
      transform: scale(1.05);
    }
    .mic-wrapper {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    #mic-button {
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 9999px;
      padding: 15px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s ease, background-color 0.2s ease;
    }
    #mic-button:hover {
      background-color: #0056b3;
      transform: scale(1.1);
    }
    .mic-wrapper.recording #mic-button {
      transform: scale(1.7);
      background-color: #28a745 !important;
    }
    #mic-button svg {
      width: 28px;
      height: 28px;
      display: block;
    }
    #status {
        position: fixed;
        bottom: 180px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border-radius: 10px;
        z-index: 9998;
        font-size: 16px;
        display: none;
    }
    #footerSocial {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 20px 0;
      display: flex;
      justify-content: center;
      gap: 40px;
      z-index: 9999;
      background-color: rgba(0, 0, 0, 0.1);
      box-shadow: 0 0 19.5px rgba(0, 0, 0, 0.47);
    }
    #footerSocial a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 34.56px;
      height: 34.56px;
      text-decoration: none;
    }
    #footerSocial svg {
      width: 34.56px;
      height: 34.56px;
      transition: transform 0.3s ease;
    }
    #footerSocial a:hover svg {
      transform: scale(1.1);
    }
    #footerSocial .facebook svg { fill: #00008B; }
    #footerSocial .instagram svg { fill: #833AB4; }
    #footerSocial .whatsapp svg { fill: #25D366; }
  </style>
</head>

<body style="margin: 0; overflow: hidden;">
  <button id="muteButton">ðŸ”‡ Ativar Som</button>

  <a-scene
    webxr="requiredFeatures: hit-test;"
    ar-hit-test="target: #reticle;"
    vr-mode-ui="enterARButton: .a-enter-ar-button"
  >
    <a-assets>
      <video id="video_chocolate" src="videos/chocolate.mp4" playsinline webkit-playsinline loop crossOrigin="anonymous"></video>
      <video id="video_acucar" src="videos/acucar.mp4" playsinline webkit-playsinline loop crossOrigin="anonymous"></video>
      <video id="video_frutas" src="videos/frutas.mp4" playsinline webkit-playsinline loop crossOrigin="anonymous"></video>
      <video id="video_inicial" src="videos/inicio.mp4" playsinline webkit-playsinline loop crossOrigin="anonymous"></video>
    </a-assets>

    <a-camera></a-camera>

    <a-entity id="reticle" geometry="primitive: ring; radius-inner: 0.05; radius-outer: 0.08" material="color: #007bff; shader: flat" visible="false"></a-entity>

    <a-entity id="video-holder" visible="false">
      <a-video id="main-video" width="1.5" height="1.5" src="#video_inicial" color="#FFFFFF" autoplay loop muted></a-video>
    </a-entity>

  </a-scene>

  <div id="status">Ouvindo...</div>
  <div class="mic-wrapper" id="mic-wrapper" style="display: none;">
      <button id="mic-button">
          <svg xmlns="http://www.w3.org/2000/svg" id="mic-icon" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd" />
          </svg>
      </button>
  </div>
  <div id="footerSocial">
    <a href="https://www.facebook.com/domatacadista/" target="_blank" class="facebook" aria-label="Facebook"><svg viewBox="0 0 24 24"><path d="M22 12a10 10 0 1 0-11.5 9.87v-6.98h-3v-2.89h3v-2.2c0-3 1.79-4.66 4.53-4.66 1.31 0 2.68.24 2.68.24v3h-1.54c-1.52 0-1.99.95-1.99 1.92v2.7h3.4l-.54 2.89h-2.86v6.98A10 10 0 0 0 22 12"/></svg></a>
    <a href="https://www.instagram.com/domatacadista/" target="_blank" class="instagram" aria-label="Instagram"><svg viewBox="0 0 24 24"><path d="M7 2C4.243 2 2 4.243 2 7v10c0 2.757 2.243 5 5 5h10c2.757 0 5-2.243 5-5V7c0-2.757-2.243-5-5-5H7zm0 2h10c1.654 0 3 1.346 3 3v10c0 1.654-1.346 3-3 3H7c-1.654 0-3-1.346-3-3V7c0-1.654 1.346-3 3-3zm5 3a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm4.5-.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg></a>
    <a href="https://wa.me/5524998132856" target="_blank" class="whatsapp" aria-label="WhatsApp"><svg viewBox="0 0 24 24"><path d="M20.52 3.48A11.955 11.955 0 0 0 12 0a12 12 0 0 0-11.99 11.89c0 2.12.56 4.09 1.52 5.82L0 24l6.6-2.43A11.95 11.95 0 0 0 12 24c6.63 0 12-5.37 12-12a11.89 11.89 0 0 0-3.48-8.52zm-8.52 15.2c-1.95 0-3.77-.62-5.23-1.68l-.37-.23-3.1 1.14 1.15-3.03-.24-.38a8.39 8.39 0 0 1-1.31-4.88c0-4.65 3.78-8.42 8.42-8.42 2.24 0 4.35.88 5.92 2.48a8.288 8.288 0 0 1 2.5 6c0 4.65-3.78 8.43-8.43 8.43zm4.52-6.28c-.25-.12-1.47-.72-1.7-.8-.23-.08-.4-.12-.57.12-.16.25-.62.8-.76.97-.14.16-.28.18-.53.06-.25-.13-1.05-.39-2-1.24-.74-.66-1.24-1.47-1.38-1.72-.14-.25-.02-.38.11-.50.11-.11.25-.29.37-.44.12-.15.16-.25.25-.42.08-.16.04-.31-.02-.44-.06-.13-.57-1.37-.78-1.87-.2-.49-.41-.42-.57-.43-.15-.01-.32-.01-.49-.01-.16 0-.42.06-.64.31-.22.25-.84.82-.84 2 .01 1.18.86 2.32.98 2.49.12.17 1.7 2.6 4.12 3.64.58.25 1.03.4 1.38.51.58.18 1.11.15 1.53.09.47-.07 1.47-.6 1.68-1.18.21-.58.21-1.07.15-1.18-.06-.11-.22-.18-.47-.30z"/></svg></a>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const sceneEl = document.querySelector('a-scene');
        const videoHolder = document.getElementById('video-holder');
        const reticle = document.getElementById('reticle');
        let isVideoPlaced = false;

        // FunÃ§Ã£o para posicionar o vÃ­deo
        const placeVideo = () => {
            if (!isVideoPlaced) {
                // Pega a posiÃ§Ã£o e orientaÃ§Ã£o da retÃ­cula
                const position = reticle.getAttribute('position');
                const rotation = reticle.getAttribute('rotation');

                // Aplica ao vÃ­deo
                videoHolder.setAttribute('position', position);
                // A rotaÃ§Ã£o do vÃ­deo pode ser fixa para ele ficar sempre "de pÃ©"
                videoHolder.setAttribute('rotation', { x: -90, y: 0, z: 0 });
                videoHolder.setAttribute('visible', 'true');
                
                isVideoPlaced = true;
                
                // Esconde a retÃ­cula depois de colocar o vÃ­deo para nÃ£o poluir a cena
                reticle.setAttribute('visible', 'false');

                // Mostra novamente o controle de voz
                document.getElementById('mic-wrapper').style.display = 'inline-flex';
            }
        };

        // WebXR 'select' event (toque na tela)
        sceneEl.addEventListener('enter-vr', () => {
            // Esconde o controle de voz atÃ© o vÃ­deo ser posicionado
            document.getElementById('mic-wrapper').style.display = 'none';

            if (sceneEl.is('ar-mode')) {
                sceneEl.xrSession.addEventListener('select', placeVideo);
            }
        });

        // LÃ³gica de voz e mudo (permanece a mesma)
        const micWrapper = document.getElementById('mic-wrapper');
        const micButton = document.getElementById('mic-button');
        const statusDiv = document.getElementById('status');
        const mainVideo = document.getElementById('main-video');
        const muteButton = document.getElementById('muteButton');
        let isMuted = true;
        let recognitionActive = false;

        const productVideos = {
            'chocolate': '#video_chocolate',
            'aÃ§Ãºcar': '#video_acucar',
            'frutas': '#video_frutas'
        };

        function setMuteState(muted) {
            const videoEl = mainVideo.getAttribute('src');
            if (videoEl && typeof videoEl === 'string') {
                const videoAsset = document.querySelector(videoEl);
                if (videoAsset) {
                    videoAsset.muted = muted;
                }
            }
            isMuted = muted;
            muteButton.textContent = muted ? 'ðŸ”‡ Ativar Som' : 'ðŸ”Š Mudo';
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'pt-BR';
            recognition.continuous = false;

            micButton.addEventListener('click', () => {
                if (recognitionActive) {
                    recognition.stop();
                } else {
                    try {
                        recognition.start();
                    } catch(e) { console.error(e); }
                }
            });

            recognition.onstart = () => {
                recognitionActive = true;
                micWrapper.classList.add('recording');
                statusDiv.textContent = "Ouvindo...";
                statusDiv.style.display = 'block';
            };

            recognition.onend = () => {
                recognitionActive = false;
                micWrapper.classList.remove('recording');
                statusDiv.style.display = 'none';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase();
                let foundProduct = false;
                for (const keyword in productVideos) {
                    if (transcript.includes(keyword)) {
                        const videoSrc = productVideos[keyword];
                        if (mainVideo.getAttribute('src') !== videoSrc) {
                            mainVideo.setAttribute('src', videoSrc);
                            const newVideoEl = document.querySelector(videoSrc);
                            newVideoEl.muted = isMuted;
                            newVideoEl.play();
                        }
                        statusDiv.textContent = `Mostrando o corredor de ${keyword}!`;
                        foundProduct = true;
                        break;
                    }
                }
                if (!foundProduct) {
                    statusDiv.textContent = `Produto nÃ£o encontrado. Tente "chocolate", "aÃ§Ãºcar" ou "frutas".`;
                }
            };
        } else {
            micWrapper.style.display = 'none';
        }

        muteButton.addEventListener('click', () => {
            setMuteState(!isMuted);
        });

        document.querySelector('#video_inicial').play().catch(e => console.error("Autoplay inicial bloqueado:", e));
        setMuteState(true);
    });
  </script>
</body>
</html>
